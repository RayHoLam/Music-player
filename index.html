<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="style.css">
    <title>Music-Player</title>
</head>
<body>
<div class="container">
    <h1>Music Player</h1>
    <input type="text" id="search" placeholder="Search for tracks...">
    <ul id="track-list"></ul>
    <button id="play">搜索後點擊曲目名稱</button>
    <audio id="audio"></audio>
</div>
    <script>
        const searchInput = document.getElementById('search');
        const trackList = document.getElementById('track-list');
        const playBtn = document.getElementById('play');
        const audio = document.getElementById('audio');
        let accessToken = ''; // 從 OAuth 獲取的 Access Token

        // OAuth 認證流程（簡化示例）
        function getAccessToken() {
            const clientId = process.env.SPOTIFY_CLIENT_ID;
            const clientSecret = process.env.SPOTIFY_CLIENT_SECRET;
	    const spotifyClientId = process.env.SPOTIFY_CLIENT_ID;
	    const spotifyClientSecret = process.env.SPOTIFY_CLIENT_SECRET;
            const basicAuth = btoa(`${clientId}:${clientSecret}`);

	    console.log('Spotify Client ID:', spotifyClientId);
	    console.log('Spotify Client Secret:', spotifyClientSecret);
	    console.log('Spotify Client ID:', clientId);
	    console.log('Spotify Client Secret:', clientSecret);

            return fetch('https://accounts.spotify.com/api/token', {
                method: 'POST',
                headers: {
                    'Authorization': `Basic ${basicAuth}`,
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: 'grant_type=client_credentials'
            })
            .then(response => response.json())
            .then(data => {
                accessToken = data.access_token;
            });
        }

        // 搜索曲目
        async function searchTracks(query) {
    try {
        const response = await fetch(`https://api.spotify.com/v1/search?q=${query}&type=track`, {
            headers: {
                'Authorization': `Bearer ${accessToken}`
            }
        });
        if (!response.ok) throw new Error('Network response was not ok');
        const data = await response.json();
        displayTracks(data.tracks.items.slice(0, 5)); // 只顯示前 5 個曲目
    } catch (error) {
        console.error('Error fetching tracks:', error);
    }
}

        // 顯示搜索結果
        function displayTracks(tracks) {
            trackList.innerHTML = '';
            tracks.forEach(track => {
                const li = document.createElement('li');
                
                // 創建一個 span 來顯示曲目名稱
                const span = document.createElement('span');
                span.innerText = `${track.name} - ${track.artists[0].name}`;
                span.style.cursor = 'pointer'; // 鼠標指針變為手型
                span.onclick = () => playTrack(track.preview_url); // 點擊事件

                li.appendChild(span);
                trackList.appendChild(li);
            });
        }

        // 播放曲目
        function playTrack(url) {
            if (url) {
                audio.src = url;
                audio.play();
            }
        }

        // 播放/暫停功能
        playBtn.addEventListener('click', () => {
            if (audio.paused) {
                audio.play();
                playBtn.innerText = 'Pause';
            } else {
                audio.pause();
                playBtn.innerText = 'Play';
            }
        });

        // 事件監聽器
        searchInput.addEventListener('input', () => {
            const query = searchInput.value;
            if (query) {
                searchTracks(query);
            }
        });

        // 初始化
        getAccessToken();
    </script>
</body>
</html>
